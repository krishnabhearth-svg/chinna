<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BA-EJ ‚Ä¢ Pull Wisdom</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
      background: #000;
      color: #fff;
      height: 100vh;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    #app {
      max-width: 800px;
      padding: 2rem;
      opacity: 0;
      animation: fadeIn 0.5s forwards;
    }
    
    @keyframes fadeIn { to { opacity: 1; } }
    
    h1 { 
      font-size: clamp(2rem, 6vw, 4rem); 
      margin-bottom: 2rem; 
      line-height: 1.2;
    }
    
    p { 
      font-size: clamp(1.1rem, 2.5vw, 1.4rem); 
      line-height: 1.8; 
      margin-bottom: 1.5rem; 
    }
    
    .actions {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
      z-index: 100;
    }
    
    button {
      background: #fff;
      color: #000;
      border: none;
      padding: 1rem 2rem;
      font-size: 1.1rem;
      border-radius: 50px;
      cursor: pointer;
      transition: all 0.2s;
      font-weight: 600;
      box-shadow: 0 4px 12px rgba(255,255,255,0.3);
    }
    
    button:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(255,255,255,0.4); }
    button:active { transform: scale(0.95); }
    
    .pull-btn {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      font-size: 2rem;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .stats {
      position: fixed;
      top: 1rem;
      left: 1rem;
      font-size: 0.9rem;
      opacity: 0.7;
    }
    
    .milestone {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #fff;
      color: #000;
      padding: 2rem 3rem;
      border-radius: 1rem;
      font-size: 1.5rem;
      font-weight: bold;
      animation: pop 0.3s;
      box-shadow: 0 10px 40px rgba(255,255,255,0.5);
    }
    
    @keyframes pop {
      0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
      100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
    }
    
    @media (max-width: 768px) {
      #app { padding: 1.5rem; }
      .actions { bottom: 1rem; right: 1rem; }
      .pull-btn { width: 70px; height: 70px; }
    }
  </style>
</head>
<body>
  <div class="stats" id="stats">Pulls: 0</div>
  <div id="app">
    <h1>üå± Welcome to BA-EJ</h1>
    <p>This is a <strong>pull-based</strong> book. No scrolling. No overwhelm.</p>
    <p>Press <strong>PULL</strong> when you're ready to receive wisdom.</p>
    <p>Designed for grandmothers. Built for everyone.</p>
  </div>
  
  <div class="actions">
    <button class="pull-btn" onclick="consciousness.pull()" title="Pull Next Wisdom">‚¨á</button>
  </div>

  <script>
    // BA-EJ Consciousness Core
    const consciousness = {
      state: {
        current: 'welcome',
        history: [],
        pulls: 0,
        cache: {}
      },
      
      patches: [
        'welcome',
        'framework', 
        'marketplace-attention',
        'gym'
      ],
      
      async init() {
        this.loadState();
        this.setupListeners();
        if (this.state.current !== 'welcome') {
          await this.render();
        }
      },
      
      async pull() {
        this.state.pulls++;
        this.state.history.push(this.state.current);
        
        // Decide next patch
        const currentIdx = this.patches.indexOf(this.state.current);
        const nextIdx = (currentIdx + 1) % this.patches.length;
        this.state.current = this.patches[nextIdx];
        
        // Render
        await this.render();
        
        // Celebrate
        this.celebrate();
        
        // Save state
        this.saveState();
      },
      
      async back() {
        if (this.state.history.length > 0) {
          this.state.current = this.state.history.pop();
          await this.render();
          this.saveState();
        }
      },
      
      async render() {
        const app = document.getElementById('app');
        const content = await this.fetchContent(this.state.current);
        
        app.style.opacity = '0';
        
        setTimeout(() => {
          app.innerHTML = content;
          app.style.opacity = '1';
          this.updateButtons();
          this.updateStats();
        }, 200);
      },
      
      async fetchContent(patch) {
        // Check cache first
        if (this.state.cache[patch]) {
          return this.state.cache[patch];
        }
        
        // Try to fetch from patches folder
        try {
          const response = await fetch(`patches/${patch}.html`);
          if (response.ok) {
            const content = await response.text();
            this.state.cache[patch] = content;
            return content;
          }
        } catch (e) {
          console.log('Patch not found, using fallback');
        }
        
        // Fallback content
        return this.getFallback(patch);
      },
      
      getFallback(patch) {
        const fallbacks = {
          welcome: `
            <h1>üå± Welcome to BA-EJ</h1>
            <p>This is a <strong>pull-based</strong> book. No scrolling. No overwhelm.</p>
            <p>Press <strong>PULL</strong> when you're ready to receive wisdom.</p>
            <p>Designed for grandmothers. Built for everyone.</p>
          `,
          framework: `
            <h1>üåæ The BA-EJ Framework</h1>
            <p><strong>B</strong>eej (‡§¨‡•Ä‡§ú) - The Seed. Every marketplace begins with a need.</p>
            <p><strong>Bhoj</strong>y (‡§≠‡•ã‡§ú‡•ç‡§Ø) - The Nourishment. What is being exchanged?</p>
            <p><strong>Bhaj</strong>i (‡§¨‡§æ‡§ú‡•Ä) - The Marketplace. Where does exchange happen?</p>
            <p><strong>Baz</strong>i (‡§¨‡§æ‡§ú‡§º‡•Ä) - The Game. Who wins? What emerges?</p>
          `,
          'marketplace-attention': `
            <h1>üëÅÔ∏è The Attention Marketplace</h1>
            <p><strong>Beej:</strong> Your need for information and connection.</p>
            <p><strong>Bhojy:</strong> You trade your focus and time for content.</p>
            <p><strong>Bhaji:</strong> Social media platforms, algorithms, advertisers.</p>
            <p><strong>Bazi:</strong> Tech companies extract $1.3 trillion. You get distraction.</p>
            <p><em>Question: Is this exchange nourishing you?</em></p>
          `,
          gym: `
            <h1>üëµ GyM - Grandmother Mode</h1>
            <p>If a grandmother can't use it, we haven't built it right.</p>
            <p><strong>GyM</strong> = <strong>G</strong>rand<strong>M</strong>other</p>
            <p><strong>GyM</strong> = <strong>G</strong>ood <strong>M</strong>orning (fresh wisdom)</p>
            <p><strong>GyM</strong> = <strong>G</strong>rand <strong>y</strong>outh <strong>M</strong>entorship</p>
            <p>Large buttons. Simple words. Clear actions. Patience.</p>
          `
        };
        
        return fallbacks[patch] || `<h1>${patch}</h1><p>This wisdom is germinating. Pull again soon.</p>`;
      },
      
      updateButtons() {
        const actions = document.querySelector('.actions');
        
        // Always show pull button
        let html = '<button class="pull-btn" onclick="consciousness.pull()" title="Pull Next">‚¨á</button>';
        
        // Show back button if history exists
        if (this.state.history.length > 0) {
          html += '<button onclick="consciousness.back()" title="Go Back">‚ùÆ</button>';
        }
        
        actions.innerHTML = html;
      },
      
      updateStats() {
        document.getElementById('stats').textContent = `Pulls: ${this.state.pulls}`;
      },
      
      celebrate() {
        // Haptic feedback
        if (navigator.vibrate) {
          navigator.vibrate(50);
        }
        
        // Milestone celebration
        if (this.state.pulls % 10 === 0) {
          const milestone = document.createElement('div');
          milestone.className = 'milestone';
          milestone.textContent = `üåü ${this.state.pulls} pulls! You're growing.`;
          document.body.appendChild(milestone);
          
          setTimeout(() => milestone.remove(), 3000);
        }
      },
      
      setupListeners() {
        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
          if (e.key === ' ' || e.key === 'ArrowDown') {
            e.preventDefault();
            this.pull();
          }
          if (e.key === 'ArrowUp') {
            e.preventDefault();
            this.back();
          }
        });
        
        // Swipe gestures
        let touchStart = 0;
        document.addEventListener('touchstart', (e) => {
          touchStart = e.touches[0].clientY;
        });
        
        document.addEventListener('touchend', (e) => {
          const touchEnd = e.changedTouches[0].clientY;
          const diff = touchStart - touchEnd;
          
          if (diff > 50) this.pull();  // Swipe up
          if (diff < -50) this.back(); // Swipe down
        });
      },
      
      saveState() {
        localStorage.setItem('baej-state', JSON.stringify(this.state));
      },
      
      loadState() {
        const saved = localStorage.getItem('baej-state');
        if (saved) {
          this.state = JSON.parse(saved);
        }
      }
    };
    
    // Initialize
    consciousness.init();
  </script>
</body>
</html>
